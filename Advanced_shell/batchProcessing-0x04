#!/bin/bash

# List of Pokémon
pokemons=("Bulbasaur" "Ivysaur" "Venusaur" "Charmander" "Charmeleon")

# Function to fetch Pokémon data
fetch_pokemon() {
    local p="$1"
    local filename=$(echo "$p" | tr '[:upper:]' '[:lower:]').json
    local url="https://pokeapi.co/api/v2/pokemon/$(echo "$p" | tr '[:upper:]' '[:lower:]')"

    max_retries=3
    attempt=1
    success=0

    while [ $attempt -le $max_retries ]; do
        response=$(curl -s -w "%{http_code}" -o "$filename" "$url")
        if [ "$response" -eq 200 ]; then
            echo "Saved $p data to $filename"
            success=1
            break
        else
            echo "Attempt $attempt for $p failed. Status code: $response"
            ((attempt++))
            sleep 1
        fi
    done

    if [ $success -eq 0 ]; then
        echo "$(date): Failed to fetch $p after $max_retries attempts" >> errors.txt
        rm -f "$filename"
    fi
}

# Export function for subshells
export -f fetch_pokemon

# Run all fetches in parallel
for p in "${pokemons[@]}"; do
    bash -c "fetch_pokemon '$p'" &
done

# Wait for all background jobs to finish
wait

echo "All Pokémon data fetched."
