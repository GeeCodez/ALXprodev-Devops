#!/bin/bash

# Output CSV file
csv_file="pokemon_report.csv"

# Write CSV header
echo "Name,Height,Weight" > "$csv_file"

# Loop through all JSON files
for file in *.json; do
    # Extract name, height, weight using jq
    name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')   # capitalize first letter
    height=$(jq '.height' "$file")
    weight=$(jq '.weight' "$file")

    # Convert height/weight to meters/kg
    height_m=$(echo "$height / 10" | bc -l)
    weight_kg=$(echo "$weight / 10" | bc -l)

    # Append to CSV
    echo "$name,$height_m,$weight_kg" >> "$csv_file"
done

# Calculate averages using awk
awk -F',' '
NR>1 {sum_h+=$2; sum_w+=$3; count++} 
END {printf "Average Height: %.2fm\nAverage Weight: %.2fkg\n", sum_h/count, sum_w/count}
' "$csv_file"
